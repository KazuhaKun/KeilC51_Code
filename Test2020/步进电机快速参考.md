# 步进电机快速参考

## 🔌 硬件连接

```
STC89C52    ULN2003D    28BYJ-48
P1.0 -----> IN1 ------> 橙线 (A相)
P1.1 -----> IN2 ------> 黄线 (B相)
P1.2 -----> IN3 ------> 粉线 (C相)
P1.3 -----> IN4 ------> 蓝线 (D相)
GND  -----> GND
5V   -----> VCC/COM --> 红线 (公共端)
```

## ⚙️ 基本参数

| 参数 | 值 |
|-----|---|
| 型号 | 28BYJ-48 |
| 电压 | 5V DC |
| 一圈步数 | 512步（四拍） |
| 步进间隔 | 2ms |
| 转速 | ~60 RPM |

## 📝 API 函数

### 1. 旋转指定步数
```c
void Stepper_Motor_Rotate(unsigned int steps, unsigned char direction);
```
- **steps**: 步数
- **direction**: 0=正转, 1=反转

**示例**：
```c
Stepper_Motor_Rotate(512, 0);  // 正转一圈
Stepper_Motor_Rotate(256, 1);  // 反转半圈
```

### 2. 开门动作（正转5圈+反转5圈）
```c
void Stepper_Motor_OpenDoor(void);
```
- 正转5圈（2560步）
- 暂停500ms
- 反转5圈（2560步）
- 总耗时：约10.7秒

## 🎯 密码锁集成

```c
// 在 main.c 中的 Safe_Proc() 函数
if (Password_Verify()) {
    // 密码正确
    LCD_ShowString(1, 1, "Password OK!    ");
    LCD_ShowString(2, 1, "Opening Door... ");
    Delay(1000);
    
    // 调用步进电机开门
    Motor_OpenDoor();  // 内部调用 Stepper_Motor_OpenDoor()
}
```

## 🔧 常见问题

| 问题 | 解决方法 |
|-----|---------|
| 电机不转 | 检查接线和电源（5V, ≥500mA） |
| 转向错误 | 交换任意两根绕组线 |
| 转速太快 | 增大 `Delay()` 值（如改为4ms） |
| 转速太慢 | 减小 `Delay()` 值（如改为1ms） |
| 发热严重 | 确保运行后关闭所有相 |

## 📊 四拍时序

```
步数  P1.3(D)  P1.2(C)  P1.1(B)  P1.0(A)  十六进制
  1      0        0        1        1       0x03
  2      0        1        1        0       0x06
  3      1        1        0        0       0x0C
  4      1        0        0        1       0x09
```

正转：1→2→3→4→1...  
反转：4→3→2→1→4...

## ✅ 测试清单

- [ ] 硬件连接正确（P1.0-P1.3 → IN1-IN4）
- [ ] 电源电压稳定（5V, ≥500mA）
- [ ] 输入正确密码（默认：12345678）
- [ ] 电机正转5圈（顺时针）
- [ ] 暂停约0.5秒
- [ ] 电机反转5圈（逆时针）
- [ ] 完成后电机停止
- [ ] LCD显示"Door Opened!"

## 🎓 进阶技巧

### 调整转速
```c
Delay(1);  // 快速：~120 RPM
Delay(2);  // 标准：~60 RPM（当前）
Delay(4);  // 慢速：~30 RPM
```

### 角度控制
```c
// 旋转90度（四拍模式）
Stepper_Motor_Rotate(128, 0);  // 512/4 = 128步

// 旋转180度
Stepper_Motor_Rotate(256, 0);  // 512/2 = 256步
```

---

**版本**: v1.0 | **日期**: 2025-10-15 | **状态**: ✅ 已完成
