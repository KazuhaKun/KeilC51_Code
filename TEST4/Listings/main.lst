C51 COMPILER V9.54   MAIN                                                                  02/25/2025 00:15:54 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main
                    -.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <REGX52.H>
   2          //#include "LCD1602.h"
   3          //#include "DS18B20.h"
   4          #include "delay.h"
   5          #include "Key.h"
   6          #include "Timer0.h"
   7          //#include "AT24C02.h"
   8          #include "Buzzer.h"
   9          #include "nixie.h"
  10          #include "XPT2046.h"
  11          
  12          
  13          
  14          // sbit Light_Green_A = P2^0;
  15          // sbit Light_Yellow_A = P2^1;
  16          // sbit Light_Red_A = P2^2;
  17          // sbit Light_Green_B = P2^4;
  18          // sbit Light_Yellow_B = P2^6;
  19          // sbit Light_Red_B = P2^7;
  20          sbit Light_Green_A = P1^0;
  21          sbit Light_Yellow_A = P1^1;
  22          sbit Light_Red_A = P1^2;
  23          sbit Light_Green_B = P1^3;
  24          sbit Light_Yellow_B = P1^4;
  25          sbit Light_Red_B = P1^5;
  26          
  27          sbit Buzzer = P2^5;
  28          
  29          unsigned char status;
  30          unsigned char FlashFlag_Light_Yellow = 0;
  31          unsigned char FlashFlag_Buzzer = 0;
  32          unsigned char KeyNum;
  33          unsigned char CountDown;
  34          unsigned int ADValue;
  35          
  36          
  37          // Nixie Show CountDown
  38          void Nixie_CountDown(unsigned char num)
  39          {
  40   1        unsigned char i,j;
  41   1        i = num/10;
  42   1        j = num%10;
  43   1        // Nixie(1,i);
  44   1        // Nixie(2,j);
  45   1        Nixie_SetBuf(1,i);
  46   1        Nixie_SetBuf(2,j);
  47   1      }
  48          
  49          void main()
  50          {
  51   1        Timer0_Init();
  52   1        while(1)
  53   1        {
  54   2          KeyNum = Key();
C51 COMPILER V9.54   MAIN                                                                  02/25/2025 00:15:54 PAGE 2   

  55   2          if(KeyNum == 1) status = 4;
  56   2          if(KeyNum == 2) status = 5;
  57   2          switch(status)
  58   2          {
  59   3            case 0:   //A Green B Red
  60   3            { //Road A
  61   4              Light_Red_A = 1;
  62   4              Light_Green_A = 0;
  63   4              //Road B
  64   4              Light_Yellow_B = 1;
  65   4              Light_Red_B = 0;
  66   4              //CountDown
  67   4              Nixie_CountDown(CountDown);
  68   4              break;
  69   4            }
  70   3            case 1:   // A Yellow
  71   3            { //Road A
  72   4              Light_Green_A = 1;
  73   4              Light_Yellow_A = FlashFlag_Light_Yellow;
  74   4              //Road B:Do nothing
  75   4              //Buzzer
  76   4              if(FlashFlag_Light_Yellow) Buzzer_Time(100);
  77   4              //CountDown
  78   4              Nixie_CountDown(CountDown);
  79   4              break;
  80   4            }
  81   3            case 2:   //B Green A Red
  82   3            { //Road A
  83   4              Light_Yellow_A = 1;
  84   4              Light_Red_A = 0;
  85   4              //Road B
  86   4              Light_Red_B = 1;
  87   4              Light_Green_B = 0;
  88   4              //CountDown
  89   4              Nixie_CountDown(CountDown);
  90   4              break;
  91   4            }
  92   3            case 3:   // B Yellow
  93   3            { //Road B
  94   4              Light_Green_B = 1;
  95   4              // if(FlashFlag_Light_Yellow == 0) Light_Yellow_B = 0;
  96   4              // if(FlashFlag_Light_Yellow == 1) Light_Yellow_B = 1;
  97   4              Light_Yellow_B = FlashFlag_Light_Yellow;
  98   4              //Road A:Do nothing
  99   4              //Buzzer
 100   4              if(FlashFlag_Light_Yellow) Buzzer_Time(100);
 101   4              //CountDown
 102   4              Nixie_CountDown(CountDown);
 103   4              break;
 104   4            }
 105   3            case 4:   //Emergency
 106   3            { //Road A
 107   4              Light_Green_A = 1;
 108   4              Light_Yellow_A = 1;
 109   4              Light_Red_A = 0;
 110   4              //Road B
 111   4              Light_Green_B = 1;
 112   4              Light_Yellow_B = 1;
 113   4              Light_Red_B = 0;
 114   4              break;
 115   4            }
 116   3            case 5:   //Night Mode
C51 COMPILER V9.54   MAIN                                                                  02/25/2025 00:15:54 PAGE 3   

 117   3            { //Road A
 118   4              Light_Green_A = 1;
 119   4              Light_Red_A = 1;
 120   4              Light_Yellow_A = FlashFlag_Light_Yellow;
 121   4              //Road B
 122   4              Light_Green_B = 1;
 123   4              Light_Red_B = 1;
 124   4              Light_Yellow_B = FlashFlag_Light_Yellow;
 125   4              break;
 126   4            }
 127   3          }
 128   2        }
 129   1      }
 130          
 131          
 132          void Timer0_Routine() interrupt 1
 133          {
 134   1        static unsigned int KeyCount, LightCount, FlashCount, T0Count;
 135   1        TL0 = 0x66; 
 136   1        TH0 = 0xFC;
 137   1        KeyCount++;
 138   1        LightCount++;
 139   1        FlashCount++;
 140   1        T0Count++;
 141   1        //Nixie Loop
 142   1        if(T0Count >= 2){T0Count = 0;Nixie_Loop();}
 143   1        //GR Scan
 144   1        if(T0Count >= 2){T0Count = 0;ADValue=XPT2046_ReadAD(XPT2046_VBAT);if(ADValue < 190) status = 5;if(ADValue
             - > 160) status = 0;}
 145   1        //Key Detect
 146   1        if(KeyCount >= 20){KeyCount = 0;Key_Loop();}
 147   1        //Flash Flag
 148   1        if (FlashCount >= 500){FlashCount = 0;FlashFlag_Light_Yellow = ~FlashFlag_Light_Yellow;}
 149   1        // //Buzzer Control
 150   1        // if(FlashCount >= 500 && (status == 1 || status == 3)) {FlashCount = 0;FlashFlag_Buzzer = ~FlashFlag_Bu
             -zzer;}
 151   1        //Light Control
 152   1        if(status == 0 && LightCount >= 5000){LightCount = 0;status = 1;}
 153   1        if(status == 1 && LightCount >= 2000){LightCount = 0;status = 2;}
 154   1        if(status == 2 && LightCount >= 5000){LightCount = 0;status = 3;}
 155   1        if(status == 3 && LightCount >= 2000){LightCount = 0;status = 0;}
 156   1        if(status == 4 && LightCount >= 10000){LightCount = 0;status = 0;}
 157   1        //LED Num
 158   1        if(LightCount%1000 == 1) {
 159   2          if(status == 0 || status == 2) CountDown = 5-(LightCount/1000);
 160   2          if(status == 1 || status == 3) CountDown = 2-(LightCount/1000);
 161   2        }
 162   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    579    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     15       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
